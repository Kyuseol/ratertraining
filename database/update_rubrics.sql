-- ============================================================================
-- 루브릭 업데이트: 새로운 채점 기준으로 교체
-- ============================================================================
-- 범주: 내용(3개), 조직(3개), 표현(2개) = 총 8개 평가요소
-- 점수: 3점 척도 (1점, 2점, 3점)
-- ============================================================================

-- 1. rubrics 테이블에 category 컬럼 추가 (이미 있다면 무시됨)
ALTER TABLE rubrics ADD COLUMN IF NOT EXISTS category VARCHAR(50);

-- 2. 기존 루브릭 데이터 삭제 (관련 scores 데이터도 삭제됨 - CASCADE)
-- 주의: 기존 채점 데이터가 모두 삭제됩니다!
TRUNCATE TABLE scores CASCADE;
DELETE FROM rubrics;

-- 3. 새로운 루브릭 데이터 삽입
INSERT INTO rubrics (
    id, 
    category, 
    name, 
    description, 
    min_score, 
    max_score, 
    display_order,
    boundary_1_2_description,
    boundary_2_3_description,
    is_active
) VALUES

-- ========== 범주 1: 내용 ==========

-- 1. 주장
(
    '10000001-0000-0000-0000-000000000001',
    '내용',
    '주장',
    '주장의 명확성과 일관성',
    1, 3, 1,
    '1점: 주장이 불명확하거나 일관성이 부족하여 논점이 제대로 전달되지 않는다. | 2점: 주장이 일관성 측면에서 일부 부족함이 있어 논점이 덜 선명하게 전달된다.',
    '3점: 주장이 명확하고 일관되며, 논점이 분명하게 드러난다.',
    TRUE
),

-- 2. 이유
(
    '10000001-0000-0000-0000-000000000002',
    '내용',
    '이유',
    '이유의 타당성과 충분성',
    1, 3, 2,
    '1점: 이유가 주장을 충분히 지지하지 못하고 근거와의 연결이 불명확하거나, 양적으로 매우 부족하다. | 2점: 이유가 주장을 부분적으로 지지하고 근거와의 연결이 모호하거나, 양적 측면에서 다소 부족하다.',
    '3점: 이유가 주장을 명확히 지지하면서 근거의 의미를 분명히 이해할 수 있으며, 양적으로 충분하다.',
    TRUE
),

-- 3. 근거
(
    '10000001-0000-0000-0000-000000000003',
    '내용',
    '근거',
    '근거의 질과 양',
    1, 3, 3,
    '1점: 근거가 이유와 구분이 불분명하거나 질적, 양적으로 매우 부족하다. | 2점: 근거가 이유와 구분되나 질적, 양적으로 다소 부족하다.',
    '3점: 근거가 이유와 주장을 잘 뒷받침하고 질적, 양적으로 충분하다.',
    TRUE
),

-- ========== 범주 2: 조직 ==========

-- 4. 통일성
(
    '10000001-0000-0000-0000-000000000004',
    '조직',
    '통일성',
    '글의 주제 중심 일관성',
    1, 3, 4,
    '1점: 글이 주제를 중심으로 구성되지 않으며, 여러 문단에서 주제와 관련 없는 내용이 포함되어 통일성이 떨어진다. | 2점: 글이 주제를 중심으로 구성되어 있으나, 일부 문단에서 주제와 일관성 없는 내용이 포함되어 있어 통일성이 다소 부족하다.',
    '3점: 글이 하나의 주제를 중심으로 일관되게 구성되었다.',
    TRUE
),

-- 5. 응집성
(
    '10000001-0000-0000-0000-000000000005',
    '조직',
    '응집성',
    '문장과 문단 간의 논리적 연결',
    1, 3, 5,
    '1점: 문장, 문단 간의 연결이 자연스럽지 않고, 응집 장치가 적절히 사용되지 않아 논리적 흐름이 흐트러진다. | 2점: 문장, 문단 간의 연결이 대체로 자연스럽지만, 몇몇 응집 장치가 부적절하게 사용되어 논리적 흐름이 다소 끊기는 부분이 있다.',
    '3점: 문장, 문단 간의 논리적 연결이 자연스럽고, 응집 장치가 적절히 사용되어 논리적 흐름이 매끄럽게 유지되었다.',
    TRUE
),

-- 6. 완결성
(
    '10000001-0000-0000-0000-000000000006',
    '조직',
    '완결성',
    '서론-본론-결론의 구조 완성도',
    1, 3, 6,
    '1점: 서론, 본론, 결론 중 한 부분 이상이 크게 부족하거나 누락되어, 논증적 글쓰기에 필수적인 구조가 확보되지 않는다. | 2점: 서론, 본론, 결론의 기본 구성은 마련되었으나, 일부가 다소 미흡하여 전체 구조의 완성도가 떨어진다.',
    '3점: 논증적인 글에 적합한 서론-본론-결론의 구조가 완성도 있게 갖추어졌다.',
    TRUE
),

-- ========== 범주 3: 표현 ==========

-- 7. 어휘·문장 적절성
(
    '10000001-0000-0000-0000-000000000007',
    '표현',
    '어휘·문장 적절성',
    '어휘와 문장의 적절성과 효과성',
    1, 3, 7,
    '1점: 어휘와 문장에서 오류가 잦고 부적절한 표현이 많아 독자의 이해를 방해한다. | 2점: 어휘와 문장에서 일부 표현이 다소 부적절하거나 미흡하여 개선이 요구된다.',
    '3점: 어휘와 문장이 글의 목적에 맞게 적절하고 효과적으로 사용되었다.',
    TRUE
),

-- 8. 어문 규범 준수
(
    '10000001-0000-0000-0000-000000000008',
    '표현',
    '어문 규범 준수',
    '맞춤법, 띄어쓰기, 문장부호 준수',
    1, 3, 8,
    '1점: 맞춤법, 띄어쓰기, 문장부호 등 국어의 기본 규범이 전혀 지켜지지 않아, 글 전체가 극히 혼란스럽고 독자의 이해를 저해한다. | 2점: 일부에서 어문 규범 위반 사례가 나타나나, 글의 의미 전달이나 독자의 이해에 지장을 주지 않는다.',
    '3점: 맞춤법, 띄어쓰기, 문장부호 등 국어의 기본 규범과 글쓰기 관습이 정확하게 지켜졌으며, 오류가 없다.',
    TRUE
);

-- ============================================================================
-- 4. 업데이트 확인
-- ============================================================================

DO $$
DECLARE
    rubric_count INTEGER;
    category_counts TEXT;
BEGIN
    SELECT COUNT(*) INTO rubric_count FROM rubrics WHERE is_active = TRUE;
    
    SELECT STRING_AGG(category || ': ' || cnt::TEXT, ', ')
    INTO category_counts
    FROM (
        SELECT category, COUNT(*) AS cnt
        FROM rubrics
        WHERE is_active = TRUE
        GROUP BY category
        ORDER BY category
    ) sub;
    
    RAISE NOTICE '';
    RAISE NOTICE '=== 루브릭 업데이트 완료 ===';
    RAISE NOTICE '총 루브릭 항목: % 개', rubric_count;
    RAISE NOTICE '범주별 항목 수: %', category_counts;
    RAISE NOTICE '';
    RAISE NOTICE '주의: 기존 채점 데이터(scores)가 모두 삭제되었습니다.';
    RAISE NOTICE '새로운 채점 데이터를 입력해주세요.';
END $$;

-- 루브릭 목록 출력
SELECT 
    display_order AS "순서",
    category AS "범주",
    name AS "세부 범주",
    description AS "설명",
    min_score || '~' || max_score AS "점수 범위"
FROM rubrics
WHERE is_active = TRUE
ORDER BY display_order;

